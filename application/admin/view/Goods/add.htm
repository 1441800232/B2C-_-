<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Chen</title>

    <meta name="description" content="Dashboard">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <!--Basic Styles-->
    <link href="__admin__/style/bootstrap.css" rel="stylesheet">
    <link href="__admin__/style/font-awesome.css" rel="stylesheet">
    <link href="style/weather-icons.css" rel="stylesheet">

    <!--Beyond styles-->
    <link id="beyond-link" href="__admin__/style/beyond.css" rel="stylesheet" type="text/css">
    <link href="__admin__/style/demo.css" rel="stylesheet">
    <link href="__admin__/style/typicons.css" rel="stylesheet">
    <link href="__admin__/style/animate.css" rel="stylesheet">
    <script  src="__UEDITOR__/ueditor/dist/utf8-php/ueditor.config.js" ></script>
    <script  src="__UEDITOR__/ueditor/dist/utf8-php/ueditor.all.min.js" ></script>
    <script  src="__UEDITOR__/ueditor/dist/utf8-php/lang/zh-cn/zh-cn.js"></script>
    <script src="./JS/add.js"></script>
    <style type="text/css">
        .price{
            width: 150px;
            margin-left: 10px;
            display: inline-block;
        }
        .a-btn{
            padding-right: 10px;
        }

    </style>
</head>

<body>
    <!-- 头部 -->
    {include file='common/top'}
    <!-- /头部 -->

    <div class="main-container container-fluid">
        <div class="page-container">
            <!-- Page Sidebar左侧 -->
            {include file='common/left'}
            <!-- /Page Sidebar -->
            <!-- Page Content -->
            <div class="page-content">
                <!-- Page Breadcrumb -->
                <div class="page-breadcrumbs">
                    <ul class="breadcrumb">
                        <li>
                            <a href="{:url('Index/index')}">系统</a>
                        </li>
                        <li>
                            <a href="{:url('Goods/lst')}">商品管理</a>
                        </li>
                        <li class="active">添加商品</li>
                    </ul>
                </div>
                <!-- /Page Breadcrumb -->

                <!-- Page Body -->
                <div class="page-body">

                    <div class="row">
                        <div class="col-lg-12 col-sm-12 col-xs-12">
                            <div class="widget">
                                <form class="form-horizontal" role="form" action="" method="post"  enctype="multipart/form-data">
                                            <!--   enctype意思是可以上传图片-->

                                            <!--商品信息开始 -->
                                            <div class="widget-body">
                                                <div class="widget-main ">
                                                    <div class="tabbable">
                                                        <ul class="nav nav-tabs tabs-flat" id="myTab11">
                                                            <li class="active">
                                                                <a data-toggle="tab" href="#baseinfo" aria-expanded="true">
                                                                    商品基本信息
                                                                </a>
                                                            </li>
                                                            <li class="">
                                                                <a data-toggle="tab" href="#goodsdes" aria-expanded="false">
                                                                    商品描述信息
                                                                </a>
                                                            </li>

                                                            <li class="">
                                                                <a data-toggle="tab" href="#mbprice" aria-expanded="false">
                                                                    会员价格
                                                                </a>
                                                            </li>

                                                            <li class="">
                                                                <a data-toggle="tab" href="#goodsattr" aria-expanded="false">
                                                                    商品属性
                                                                </a>
                                                            </li>

                                                            <li class="">
                                                                <a data-toggle="tab" href="#goodsphoto" aria-expanded="false">
                                                                    商品相册
                                                                </a>
                                                            </li>
                                                        </ul>
                                                        <div class="tab-content tabs-flat">
                                                            <div id="baseinfo" class="tab-pane active">
                                                                <div class="form-group">
                                                                    <label for="username" class="col-sm-2 control-label no-padding-right">
                                                                        商品名称
                                                                    </label>
                                                                    <div class="col-sm-6">
                                                                        <input class="form-control"  placeholder="" name="goods_name" required="" type="text">
                                                                    </div>
                                                                    <p class="help-block col-sm-4 red">* 必填</p>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label for="username" class="col-sm-2 control-label no-padding-right">商品主图</label>
                                                                    <div class="col-sm-6">
                                                                        <input class="form-control" style="border: none; box-shadow:none"  name="og_thumb"  type="file">
                                                                    </div>


                                                                </div>

                                                            <div class="form-group">
                                                                <label for="username" class="col-sm-2 control-label no-padding-right">上架</label>
                                                                <div class="col-sm-6">
                                                                    <div class="radio">
                                                                        <label>
                                                                        <input name="on_sale" checked="checked" type="radio" class="colored-blue" value="1">
                                                                        <span class="text">是</span>
                                                                        </label>

                                                                        <label>
                                                                            <input name="on_sale"   type="radio" class="colored-blue" value="0">
                                                                            <span class="text">否</span>
                                                                        </label>

                                                                    </div>
                                                                </div>
                                                            </div>

                                                                <div class="form-group">
                                                                    <label for="username" class="col-sm-2 control-label no-padding-right">所属栏目</label>
                                                                    <div class="col-sm-6">
                                                                       <SELECT name="category_id">
                                                                           <option value="">请选择</option>
                                                                           {volist name='CategoryRes' id='cate'}
                                                                           <!-- 如果当前栏目的pid 等于我们现在 正在循环的某一个id的话那么就是我们当前栏目的上级栏目   selected="selected"选定-->
                                                                           <option value="{$cate.id}"><?php echo str_repeat('--',  $cate['level']*6)?>{$cate.cate_name}</option>
                                                                           {/volist}
                                                                       </SELECT>
                                                                    </div>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label for="username" class="col-sm-2 control-label no-padding-right">所属品牌</label>
                                                                    <div class="col-sm-6">
                                                                        <SELECT name="brand_id">
                                                                            <!--一定要给一个空值，要不然下面免得volist里面的值就会是上面的‘请选择’ -->
                                                                            <option value="">请选择</option>
                                                                            {volist name="brandRes" id="brand"}
                                                                            <option value="{$brand.id}"> {$brand.brand_name}</option>
                                                                            {/volist}
                                                                        </SELECT>
                                                                    </div>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label for="username" class="col-sm-2 control-label no-padding-right">
                                                                        市场价格
                                                                    </label>
                                                                    <div class="col-sm-6">
                                                                        <input class="form-control"  placeholder=""  name="markte_price" required="" type="text">
                                                                    </div>
                                                                    <p class="help-block col-sm-4 red">* 必填</p>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label for="username" class="col-sm-2 control-label no-padding-right">
                                                                        本店价格
                                                                    </label>
                                                                    <div class="col-sm-6">
                                                                        <input class="form-control"  placeholder="" name="shop_price" required="" type="text">
                                                                    </div>
                                                                    <p class="help-block col-sm-4 red">* 必填</p>
                                                                </div>

                                                                <div class="form-group">
                                                                    <label for="username" class="col-sm-2 control-label no-padding-right">商品重量</label>
                                                                    <div class="col-sm-6">
                                                                        <input class="form-control" style="width: 300px; display: inline-block;"  placeholder="" name="goods_weight" required="" type="text">
                                                                        <select name="weiht_uint">
                                                                            <option value="kg">kg</option>
                                                                            <option value="g">g</option>
                                                                        </select>
                                                                    </div>
                                                                </div>
                                                            </div>




                                                            <div id="goodsdes" class="tab-pane">
                                                                <textarea id="goods_des"></textarea>
                                                            </div>




                                                                <div id="mbprice" class="tab-pane">
                                                                   {volist name="mlRes" id="ml"}
                                                                    <div class="form-group">
                                                                        <label for="username" class="col-sm-2 control-label no-padding-right">
                                                                            {$ml.level_name}
                                                                        </label>
                                                                        <div class="col-sm-6">
                                                                            <input class="form-control"  placeholder="" name="mp[{$ml.id}]"  type="text">
                                                                        </div>
                                                                    </div>
                                                                   {/volist}
                                                                </div>

                                                            <div id="goodsattr" class="tab-pane">
                                                                <div class="form-group">
                                                                    <label for="username" class="col-sm-2 control-label no-padding-right">商品类型</label>
                                                                    <div class="col-sm-6">
                                                                        <SELECT name="type_id"> <!--通过着name 切换类型实时 进行绑定下面数据属性   -->
                                                                                <option value="0">请选择</option>
                                                                            {volist name="typeRes" id="type"}
                                                                            <option value="{$type.id}">{$type.type_name}</option>
                                                                            {/volist}
                                                                        </SELECT>
                                                                    </div>
                                                                    <p class="help-block col-sm-4 red">* 必填</p>
                                                                </div>

                                                                <div id="attr_list">
                                                                    <!-- 商品属性显示-->
                                                                </div>

                                                            </div>

                                                            <div id="goodsphoto" class="tab-pane">
                                                                <div class="form-group"></div>
                                                                <div class="form-group">
                                                                    <label for="username" class="col-sm-2 control-label no-padding-right"></label>
                                                                    <div class="col-sm-6">
                                                                        <!-- addphoto(this) 是定义一个方法 并把他自己传递进去，
                                                                        this就是把自己传递进去 自己就是a标签这个元素-->
                                                                        <a onclick="addrow(this);" href="#">[+]</a>
                                                                        <!--name=“”改成数组模式才可以接收到所有的提交的图片-->
                                                                        <input class="form-control" style="border: none;width: 50%; box-shadow:none; display: inline-block"  name="goods_photo[]"  type="file">
                                                                    </div>
                                                                </div>

                                                                <div id="goods_photo">

                                                                </div>




                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <div class="col-sm-offset-2 col-sm-10">
                                                            <button type="submit" class="btn btn-default">保存信息</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            <!--商品信息结束 -->
                                 </form>
                            </div>
                        </div>
                    </div>

                </div>
                <!-- /Page Body -->
            </div>
            <!-- /Page Content -->
        </div>
    </div>

    <!--Basic Scripts-->
    <script src="__admin__/style/jquery_002.js"></script>
    <script src="__admin__/style/bootstrap.js"></script>
    <script src="__admin__/style/jquery.js"></script>
    <!--Beyond Scripts-->
    <script src="__admin__/style/beyond.js"></script>
    <script type="text/javascript">/*富文本编辑器设置*/
    var ue = UE.getEditor('goods_des',{initialFrameWidth:620,initialFrameHeight:400 });




    </script>

    <script type="text/javascript">
        // 利用json来写
        //主要功能：当我切换点击类型的时候，就要获取当前这个最新的类型的他下面有那些属性{所有属性}（根据类型的id获取到这类型下面有那些属性）
        // 选定select,根据select的name来选定他的name是等于type_id,当他的值change（值发送改变的）的时候就执行里面的命名函数
        $("select[name=type_id]").change(function () {
            var type_id = $(this).val();
            //通过ajax的异步请求获取当前类型下面的属性
            $.ajax({
                type:"POST",
                url:"{:url('Attr/ajaxGetAttr')}", //通过类型的id获取属性的方法在attr控制下面的AjaxGetAttr方法
                data:{type_id:type_id}, //发送的参数
                dataType:"json",//接收的数据格式是json格式
                success:function(data){ //我们获取——经过异步的请求或去的数据就是data
                    var html = ''; //定义一个空的字符串
                    $(data).each(function (k,v){  //date是一个二维数组 ，每次都会把一条记入给了v，一个v就代表一个属性
                         // html+=v.attr_name+":<input type='text'/><br>";
                        if (v.attr_type == 1){
                            //单选处理
                            html+="<div class='form-group'>"
                            html+= "<label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label>";
                            var attrValuesArr = v.attr_values.split(",") //对他进行拆分 split函数是拆分把一个字符串分割成字符串数组
                           //等拆分的数组放到这里  //addrow(this) 是定义一个方法 并把他自己传递进去，this就是把自己传递进去 自己就是a标签这个元素
                            html+="<div class='col-sm--6'><a class='a-btn' onclick='addrow(this);' href='#'>[+]</a>";
                            html+="<select name='goods_attr["+v.id+"][]'>";//goods_attr 后面加[] 是要以数组的形式处理上传 因为他是多个上传
                            html+="<option value=''>请选择</option>";
                            //循环得到的数组
                            for (var i=0; i<attrValuesArr.length; i++){
                                //循环选项 (循环的属性值是attrValuesArr里的i)
                                html+="<option value='"+attrValuesArr[i]+"'>"+attrValuesArr[i]+"</option>";
                                }
                            html+="</select>";
                            html+="<input type='text'  placeholder='价格' class='form-control price' name='attr_price[]'  >";//attr_price 后面加[] 是要以数组的形式处理上传 因为他是多个上传
                            html+="</div></div> ";




                            }else {
                            //唯一处理
                            if (v.attr_values){
                                html+="<div class='form-group'>"
                                html+= "<label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label>";
                                var attrValuesArr = v.attr_values.split(",") //对他进行拆分 split函数是拆分把一个字符串分割成字符串数组
                                //等拆分的数组放到这里
                                html+="<div class='col-sm--6'>";
                                html+="<select name='goods_attr["+v.id+"]'>";
                                html+="<option value=''>请选择</option>";
                                //循环得到的数组
                                for (var i=0; i<attrValuesArr.length; i++){
                                    //循环选项 (循环的属性值是attrValuesArr里的i)
                                    html+="<option value='"+attrValuesArr[i]+"'>"+attrValuesArr[i]+"</option>";
                                }
                                html+="</select>";
                                html+="</div></div> ";

                            }else {
                                //单行文本框
                                html+="<div class='form-group'>"
                                html+= "<label class='col-sm-2 control-label no-padding-right'>"+v.attr_name+"</label>";
                                var attrValuesArr = v.attr_values.split(",") //对他进行拆分 split函数是拆分把一个字符串分割成字符串数组
                                //等拆分的数组放到这里
                                html+="<div class='col-sm--6'>";
                                html+="<input type='text'  name='goods_attr["+v.id+"]'   class='form-control price' >"
                                html+="</div></div> ";
                            }


                        }
                    });
                    $("#attr_list").html(html);//用css定义的id属性来选择 ,直接把定义的var html 放进去
                }
            })
        })

        //addrow方法可以对select加一对减一
        function addrow(o) {
            //定义最外层的div 他下面的副记标签的父记标签 parent()就是父记标签的意思是
          var div=$(o).parent().parent();
          if ($(o).html()  == '[+]'){
              //clone()函数就复制克隆
              var newdiv=div.clone();//clone是克隆方法，克隆方法生成被选元素的副本，包含子节点、文本和属性。
              newdiv.find('a').html('[-]');//利用find函数去查询到newdiv里的a标签，在利用html把a标签里面的'+'修改成'-'
              div.after(newdiv);
          }else {
              //remove函数
              //方法移除被选元素，包括所有的文本和子节点。
              // 该方法也会移除被选元素的数据和事件。
              //删除所有匹配的元素。
              div.remove();
          }
        }





    </script>


</body>

</html>